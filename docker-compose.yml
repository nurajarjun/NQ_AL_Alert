version: '3.8'

services:
  nq-alerts:
    build: .
    container_name: nq-ai-alerts
    ports:
      - "8001:8001"
    environment:
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - NEWS_API_KEY=${NEWS_API_KEY}
      - PYTHONUNBUFFERED=1
    volumes:
      # Persist trained models
      - ./ml/models:/app/ml/models
      # Persist data cache
      - ./ml/data:/app/ml/data
      # Persist trade tracking database
      - ./backend/ml/data:/app/backend/ml/data
      # [CRITICAL] Sync Code (Avoid Rebuilds)
      - ./:/app
    network_mode: "host"
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8001/" ]
      interval: 60s
      timeout: 10s
      retries: 5
      start_period: 120s
